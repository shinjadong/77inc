# 칠칠기업 법인카드 사용용도 자동분류 프로그램 상세 지시서
작성시각: 2025-10-21 17:43

## 1. 배경 및 목표
- **배경**: 칠칠기업은 분기별 부가세 신고 시 법인카드 내역의 '사용용도' 입력을 분류 기준에 따라 일괄 처리합니다. 현재 1~6월 실사 데이터로부터 **가맹점명 ↔ 사용용도** 매칭 DB가 정제되었고, 7월 데이터는 일부 예측 라벨을 포함합니다.
- **목표**: (1) 신규/미등록 가맹점에 대해 **AI 자동분류**로 사용용도를 예측하고, (2) 확정 매칭 DB를 지속 학습·확장하여 **자동 완성률·정확도**를 높입니다.

## 2. 용어 정의
- **가맹점명**: 카드사 청구명세서상의 거래처/상호명 텍스트
- **사용용도(라벨)**: 사내 분류 체계(예: 중식대, 차량유지비(주유), 차량유지비(기타), 사용료, 복리후생비(의료), 소모품비 등)
- **확정 라벨**: 실사에서 검증된 라벨(예측 표시 없음)
- **예측 라벨**: 규칙/모델로 임시 할당된 라벨(“[예측]” 포함)

## 3. 데이터 소스 및 스키마
### 3.1 입력 원천
- **카드사 명세서**: XLSX/CSV (월별 또는 전체월)
- 필드 예시: `일자, 가맹점명, 사용금액, 승인번호, 매입/청구일자, 카드번호(3987)`

### 3.2 학습/추론용 정제 데이터
- **정답 DB**: `/mnt/data/법인카드_가맹점-사용용도_DB.csv`
  - 컬럼: `가맹점명, 사용용도` (중복 제거)
- **추론 입력 표준형**:
  - 컬럼: `일자, 가맹점명, 사용금액, (선택)지역/업종 키워드`

## 4. 기능 요구사항
1. **전처리**
   - 파일 자동 컬럼매핑(가맹점명/일자/금액 식별)
   - 텍스트 정규화: 공백, 괄호/지점명 처리, 한영/대소문자, 특수문자·이모지 제거
   - 유의어 표준화: “써브웨이/서브웨이”, “오일뱅크/오일 뱅크” 등
2. **라벨링 로직(우선순위)**
   1) **정확 일치 룩업**: 정답 DB에서 `가맹점명` 완전일치 시 사용용도 확정
   2) **부분/유사 매칭**: N-gram, Fuzzy(편집거리)로 상호명 패턴 매칭(예: “맥도날드 안산고잔DT점” → “맥도날드”)
   3) **AI 모델 예측**: 미매칭 건은 텍스트 분류 모델로 사용용도 예측(신뢰도 스코어 포함)
   4) **규칙 보정**: “주유/주유소/GS/S-OIL/IC주유소/톨게이트/주차/하이패스/세차” 등 키워드 사전으로 후처리
3. **휴리스틱 사전(룰베이스)**
   - 차량유지비(주유): “주유소, GS칼텍스, S-OIL, 오일뱅크, SK에너지, 현대오일…”
   - 차량유지비(기타): “하이패스, 톨게이트, 통행, 주차, 세차…”
   - 중식대: “맥도날드, 써브웨이, 반점, 중화요리, 순대국, 설렁탕, 커피, 카페…”
   - 사용료: “한글과컴퓨터, MS, Microsoft, Adobe, 클라우드, 오피스365, 자동결제…”
   - 복리후생비(의료): “약국, 병원, 의원, 의료…”
   - 소모품비: “문구, 다이소, 오피스, 토너, 잉크, 복사용지, 쿠팡, 이마트…”
4. **모델 요구사항**
   - 멀티클래스 텍스트 분류
   - 한글 형태소 기반 또는 Sentence Embedding 기반(예: KoSentence-BERT) 권장
   - 입력: `가맹점명(정규화 포함)`
   - 출력: `예측사용용도, 신뢰도(0~1)`
   - 미달 임계치(threshold) 시 “미분류”로 두고 수동확정 후 DB 업데이트
5. **학습 파이프라인**
   - 데이터 분리: Train/Valid/Test (예: 70/15/15)
   - K-Fold(옵션)로 소수 클래스 균형 확인
   - 클래스 불균형 대응: class weight, focal loss, 또는 데이터 증강(유의어 치환)
6. **추론 파이프라인**
   - 월별 카드사 파일 업로드 → 전처리 → 룩업 → 유사매칭 → 모델 → 규칙보정
   - 결과 컬럼: `일자, 가맹점명, 사용금액, 사용용도, 신뢰도, 라벨출처(룩업/유사/모델/규칙)`
7. **피드백 루프(Active Learning)**
   - 사용자(경리) 검토 후 확정 라벨로 저장 → 정답 DB 자동 갱신
   - 재학습 트리거: 정답 DB 증가(예: 50건 단위) 시 야간 배치 학습

## 5. 품질지표 및 검증
- 정확도(Accuracy), Macro F1 (클래스 불균형 고려)
- Top-2 Recall(검토 UI에서 후보2 제시 시)
- 예측 신뢰도 Calibration(Platt scaling/Temperature scaling)

## 6. 시스템 구성/연동
- **입출력 형식**: CSV/XLSX
- **저장소**: `/mnt/data/` (개발 단계), 운영은 사내 NAS/DB
- **API(옵션)**:
  - `POST /classify` : 파일 업로드 또는 JSON 목록 → 라벨링 결과 반환
  - `POST /feedback` : 확정 라벨 수집 → 정답 DB 반영
- **권한/보안**
  - 카드번호/개인정보 마스킹
  - 파일 보존기간 관리(예: 1년)

## 7. UI 요구(간단 웹/내부도구)
- 파일 업로드 → 미리보기 → 자동분류 결과 표
- 필터: “신규/미분류/신뢰도 낮음/예측”
- 인라인 수정 → 저장(정답 DB 업데이트)
- 집계 리포트: 분류별 합계, 가맹점별 금액, 월별 추이

## 8. 에지 케이스
- 동일 상호, 다른 용도(상황 의존): 라벨출처 우선순위/날짜·메모 참고
- 오기/오탈자 상호: 유사매칭 강화
- 멀티 영수증/분할 결제: 승인번호로 묶기(확장 과제)
- 해외 결제/외화: 통화 환산 로직(확장 과제)

## 9. 개발 체크리스트
- [ ] 전처리/정규화 유닛테스트
- [ ] 룩업/유사매칭 정확도 테스트 (threshold 튜닝)
- [ ] 모델 학습 스크립트/추론 스크립트 분리
- [ ] 로깅/오류처리(미분류 큐 적재)
- [ ] 재현성(Seed 고정), 버전관리(정답 DB 스냅샷)

## 10. 납품 산출물
- 소스코드(전처리·모델·추론·API)
- 요구사항 만족 테스트 리포트
- 운영 가이드(배포/학습/재학습/백업)

---
부가 요청이 있으면 이 지시서를 최신화하겠습니다.
