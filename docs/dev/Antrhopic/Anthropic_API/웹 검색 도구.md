# 웹 검색 도구

> Claude가 실시간 웹 콘텐츠에 직접 액세스하여 지식 컷오프를 넘어선 최신 정보로 질문에 답할 수 있게 해주는 웹 검색 도구입니다.

웹 검색 도구는 Claude에게 실시간 웹 콘텐츠에 대한 직접 액세스를 제공하여, 지식 컷오프를 넘어선 최신 정보로 질문에 답할 수 있게 해줍니다. Claude는 답변의 일부로 검색 결과에서 자동으로 출처를 인용합니다.

**피드백**: 웹 검색 도구에 대한 경험을 공유하려면 [피드백 양식](https://forms.gle/sWjBtsrNEY2oKGuE8)을 통해 연락해 주세요.

---

## 지원되는 모델

웹 검색은 다음 모델에서 사용할 수 있습니다:
- Claude Sonnet 4.5 (`claude-sonnet-4-5-20250929`)
- Claude Sonnet 4 (`claude-sonnet-4-20250514`)
- Claude Sonnet 3.7 (`claude-3-7-sonnet-20250219`)
- Claude Haiku 4.5 (`claude-haiku-4-5-20251001`)
- Claude Opus 4.1 (`claude-opus-4-1-20250805`)
- Claude Opus 4 (`claude-opus-4-20250514`)

---

## 웹 검색 작동 방식

API 요청에 웹 검색 도구를 추가하면:

1. Claude가 프롬프트를 기반으로 언제 검색할지 결정합니다
2. API가 검색을 실행하고 Claude에게 결과를 제공합니다 (이 과정은 단일 요청 중에 여러 번 반복될 수 있습니다)
3. 차례가 끝나면 Claude가 인용된 출처와 함께 최종 응답을 제공합니다

---

## 웹 검색 사용 방법

**전제조건**: 조직의 관리자가 [Console](https://console.anthropic.com/settings/privacy)에서 웹 검색을 활성화해야 합니다.

API 요청에 웹 검색 도구를 제공하세요:

### Shell

```bash
curl https://api.anthropic.com/v1/messages \
    --header "x-api-key: $ANTHROPIC_API_KEY" \
    --header "anthropic-version: 2023-06-01" \
    --header "content-type: application/json" \
    --data '{
        "model": "claude-sonnet-4-5",
        "max_tokens": 1024,
        "messages": [
            {
                "role": "user",
                "content": "What'\''s the weather in NYC?"
            }
        ],
        "tools": [{
            "type": "web_search_20250305",
            "name": "web_search",
            "max_uses": 5
        }]
    }'
```
### Python

```python
import anthropic
client = anthropic.Anthropic()
response = client.messages.create(
    model="claude-sonnet-4-5",
    max_tokens=1024,
    messages=[
        {
            "role": "user",
            "content": "What's the weather in NYC?"
        }
    ],
    tools=[{
        "type": "web_search_20250305",
        "name": "web_search",
        "max_uses": 5
    }]
)
print(response)
```
### TypeScript

```typescript
import { Anthropic } from '@anthropic-ai/sdk';
const anthropic = new Anthropic();
async function main() {
  const response = await anthropic.messages.create({
    model: "claude-sonnet-4-5",
    max_tokens: 1024,
    messages: [
      {
        role: "user",
        content: "What's the weather in NYC?"
      }
    ],
    tools: [{
      type: "web_search_20250305",
      name: "web_search",
      max_uses: 5
    }]
  });
  console.log(response);
}
main().catch(console.error);
```

---
## 도구 정의

웹 검색 도구는 다음 매개변수를 지원합니다:

```json
{
  "type": "web_search_20250305",
  "name": "web_search",

  "max_uses": 5,

  "allowed_domains": ["example.com", "trusteddomain.org"],

  "blocked_domains": ["untrustedsource.com"],

  "user_location": {
    "type": "approximate",
    "city": "San Francisco",
    "region": "California",
    "country": "US",
    "timezone": "America/Los_Angeles"
  }
}
```

### max_uses 매개변수

`max_uses` 매개변수는 수행되는 검색 횟수를 제한합니다. Claude가 허용된 것보다 더 많은 검색을 시도하면, `web_search_tool_result`는 `max_uses_exceeded` 오류 코드와 함께 오류가 됩니다.

### 도메인 필터링
도메인 필터를 사용할 때의 규칙:
- 도메인에는 HTTP/HTTPS 스키마를 포함하지 않습니다 (`https://example.com` 대신 `example.com` 사용)
- 하위 도메인이 자동으로 포함됩니다 (`example.com`은 `docs.example.com` 포함)
- 하위 경로가 지원됩니다 (`example.com/blog`)
- `allowed_domains` 또는 `blocked_domains` 중 하나만 사용 가능합니다 (동일 요청에서 둘 다 사용 불가)

**중요**: 요청 수준 도메인 제한은 Console에서 구성된 조직 수준 도메인 제한과 호환되어야 합니다. 요청 수준 도메인은 도메인을 더 제한할 수만 있으며, 조직 수준 목록을 재정의하거나 확장할 수 없습니다. 요청에 조직 설정과 충돌하는 도메인이 포함된 경우, API는 유효성 검사 오류를 반환합니다.

### 지역화
`user_location` 매개변수를 사용하면 사용자의 위치를 기반으로 검색 결과를 지역화할 수 있습니다:

- `type`: 위치 유형 (`approximate`이어야 함)
- `city`: 도시 이름
- `region`: 지역 또는 주
- `country`: 국가
- `timezone`: [IANA 시간대 ID](https://en.wikipedia.org/wiki/List_of_tz_database_time_zones)

---
## API 응답
### 응답 구조 예시
```json
{
  "role": "assistant",
  "content": [

    {
      "type": "text",
      "text": "I'll search for when Claude Shannon was born."
    },

    {
      "type": "server_tool_use",
      "id": "srvtoolu_01WYG3ziw53XMcoyKL4XcZmE",
      "name": "web_search",
      "input": {
        "query": "claude shannon birth date"
      }
    },

    {
      "type": "web_search_tool_result",
      "tool_use_id": "srvtoolu_01WYG3ziw53XMcoyKL4XcZmE",
      "content": [
        {
          "type": "web_search_result",
          "url": "https://en.wikipedia.org/wiki/Claude_Shannon",
          "title": "Claude Shannon - Wikipedia",
          "encrypted_content": "EqgfCioIARgBIiQ3YTAwMjY1Mi1mZjM5LTQ1NGUtODgxNC1kNjNjNTk1ZWI3Y...",
          "page_age": "April 30, 2025"
        }
      ]
    },
    {
      "text": "Based on the search results, Claude Shannon was born on April 30, 1916, in Petoskey, Michigan",
      "type": "text",
      "citations": [
        {
          "type": "web_search_result_location",
          "url": "https://en.wikipedia.org/wiki/Claude_Shannon",
          "title": "Claude Shannon - Wikipedia",
          "encrypted_index": "Eo8BCioIAhgBIiQyYjQ0OWJmZi1lNm..",
          "cited_text": "Claude Elwood Shannon (April 30, 1916 – February 24, 2001) was an American mathematician..."
        }
      ]
    }
  ],
  "id": "msg_a930390d3a",
  "usage": {
    "input_tokens": 6039,
    "output_tokens": 931,
    "server_tool_use": {
      "web_search_requests": 1
    }
  },
  "stop_reason": "end_turn"
}
```

### 검색 결과 필드

각 검색 결과에 포함되는 항목:
- `url`: 소스 페이지의 URL
- `title`: 소스 페이지의 제목
- `page_age`: 사이트가 마지막으로 업데이트된 시기
- `encrypted_content`: 인용을 위해 다중 턴 대화에서 다시 전달되어야 하는 암호화된 콘텐츠
### 인용 필드
각 `web_search_result_location` 인용에 포함되는 항목:
- `url`: 인용된 소스의 URL
- `title`: 인용된 소스의 제목
- `encrypted_index`: 다중 턴 대화를 위해 다시 전달되어야 하는 참조
- `cited_text`: 인용된 콘텐츠의 최대 150자
**중요**: `cited_text`, `title`, `url`은 입력 또는 출력 토큰 사용량에 포함되지 않습니다.
**주의**: API 출력을 최종 사용자에게 직접 표시할 때는 원본 소스에 대한 인용이 포함되어야 합니다. 최종 사용자에게 표시하기 전에 재처리 및/또는 자체 자료와 결합하는 등 API 출력을 수정하는 경우, 법무팀과의 상담을 바탕으로 적절하게 인용을 표시하세요.
---
## 오류 처리

웹 검색 도구에서 오류가 발생하면 (속도 제한 도달 등), Claude API는 여전히 200 (성공) 응답을 반환합니다. 오류는 다음 구조를 사용하여 응답 본문 내에서 표현됩니다:

```json
{
  "type": "web_search_tool_result",
  "tool_use_id": "servertoolu_a93jad",
  "content": {
    "type": "web_search_tool_result_error",
    "error_code": "max_uses_exceeded"
  }
}
```

### 가능한 오류 코드

- `too_many_requests`: 속도 제한 초과
- `invalid_input`: 잘못된 검색 쿼리 매개변수
- `max_uses_exceeded`: 최대 웹 검색 도구 사용 횟수 초과
- `query_too_long`: 쿼리가 최대 길이 초과
- `unavailable`: 내부 오류 발생
### pause_turn 중지 이유

응답에는 `pause_turn` 중지 이유가 포함될 수 있으며, 이는 API가 장시간 실행되는 턴을 일시 중지했음을 나타냅니다. Claude가 턴을 계속하도록 하려면 응답을 그대로 후속 요청에 제공하거나, 대화를 중단하려면 콘텐츠를 수정할 수 있습니다.

---

## 고급 기능

### 프롬프트 캐싱

웹 검색은 [프롬프트 캐싱](/ko/docs/build-with-claude/prompt-caching)과 함께 작동합니다. 프롬프트 캐싱을 활성화하려면 요청에 최소 하나의 `cache_control` 중단점을 추가하세요. 시스템은 도구를 실행할 때 마지막 `web_search_tool_result` 블록까지 자동으로 캐시합니다.

다중 턴 대화의 경우, 캐시된 콘텐츠를 재사용하려면 마지막 `web_search_tool_result` 블록에서 또는 그 이후에 `cache_control` 중단점을 설정하세요.

#### Python 예시
```python
import anthropic
client = anthropic.Anthropic()
# 웹 검색과 캐시 중단점이 있는 첫 번째 요청
messages = [
    {
        "role": "user",
        "content": "What's the current weather in San Francisco today?"
    }
]
response1 = client.messages.create(
    model="claude-sonnet-4-5",
    max_tokens=1024,
    messages=messages,
    tools=[{
        "type": "web_search_20250305",
        "name": "web_search",
        "user_location": {
            "type": "approximate",
            "city": "San Francisco",
            "region": "California",
            "country": "US",
            "timezone": "America/Los_Angeles"
        }
    }]
)
# 대화에 Claude의 응답 추가
messages.append({
    "role": "assistant",
    "content": response1.content
})
# 검색 결과 이후 캐시 중단점이 있는 두 번째 요청
messages.append({
    "role": "user",
    "content": [
        {
            "type": "text",
            "text": "Should I expect rain later this week?",
            "cache_control": {"type": "ephemeral"}
        }
    ]
})
response2 = client.messages.create(
    model="claude-sonnet-4-5",
    max_tokens=1024,
    messages=messages,
    tools=[{
        "type": "web_search_20250305",
        "name": "web_search",
        "user_location": {
            "type": "approximate",
            "city": "San Francisco",
            "region": "California",
            "country": "US",
            "timezone": "America/Los_Angeles"
        }
    }]
)

print(f"Cache read tokens: {response2.usage.get('cache_read_input_tokens', 0)}")
```

### 스트리밍
스트리밍이 활성화된 상태에서는 스트림의 일부로 검색 이벤트를 받게 됩니다. 검색이 실행되는 동안 일시 중지가 있을 것입니다.
#### 스트리밍 출력 예시
```json
event: message_start
data: {"type": "message_start", "message": {"id": "msg_abc123", "type": "message"}}

event: content_block_start
data: {"type": "content_block_start", "index": 0, "content_block": {"type": "text", "text": ""}}

event: content_block_delta
data: {"type": "content_block_delta", "index": 0, "delta": {"type": "text_delta", "text": "I'll search for the latest quantum computing breakthroughs"}}

event: content_block_start
data: {"type": "content_block_start", "index": 1, "content_block": {"type": "server_tool_use", "id": "srvtoolu_xyz789", "name": "web_search"}}


event: content_block_delta
data: {"type": "content_block_delta", "index": 1, "delta": {"type": "input_json_delta", "partial_json": "{\"query\":\"latest quantum computing breakthroughs 2025\"}"}}


event: content_block_start
data: {"type": "content_block_start", "index": 2, "content_block": {"type": "web_search_tool_result", "tool_use_id": "srvtoolu_xyz789"}}
event: message_stop
data: {"type": "message_stop"}
```

### 배치 요청

[Messages Batches API](/ko/docs/build-with-claude/batch-processing)에 웹 검색 도구를 포함할 수 있습니다. Messages Batches API를 통한 웹 검색 도구 호출은 일반 Messages API 요청과 동일하게 가격이 책정됩니다.

---

## 사용량 및 가격

### 사용량 정보
```json
"usage": {
  "input_tokens": 105,
  "output_tokens": 6039,
  "cache_read_input_tokens": 7123,
  "cache_creation_input_tokens": 7345,
  "server_tool_use": {
    "web_search_requests": 1
  }
}
```

### 가격

웹 검색은 **$10 per 1,000 검색**으로 제공되며, 표준 토큰 비용이 추가됩니다.

웹 검색 결과에서 검색된 콘텐츠는 입력 토큰으로 계산되며, 단일 턴 내 검색 반복 및 후속 대화 턴에서도 유지됩니다.

각 웹 검색은 반환된 결과 수에 관계없이 하나의 사용으로 계산됩니다. 웹 검색 중 오류가 발생하면 요금이 청구되지 않습니다.

---

## 다음 단계

- [메시지 API](/ko/docs/api/messages)에서 웹 검색에 대한 완전한 기술 문서를 확인하세요
- [도구 사용](/ko/docs/build-with-claude/tool-use)과 결합하여 검색 결과를 처리하세요
- [스트리밍](/ko/docs/build-with-claude/streaming)을 활용하여 실시간 응답을 제공하세요